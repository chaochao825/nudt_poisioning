## 5. 启动数据投毒攻击 API (SSE流式响应)

### 5.1 启动数据投毒攻击
```http
POST 127.0.0.1:19001/api-ai-server/poisoning-training/execute-poisoning-v1
```
**输入参数：**
```json
{
  "callback_params": {
    "task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301",
    "method_type": "数据投毒",
    "algorithm_type": "BadNets",
    "task_type": "投毒攻击执行",
    "task_name": "BadNets数据投毒攻击",
    "parent_task_id": "f54d72a78c264f9bb93695f522881e7c",
    "user_name": "zhangxueyou"
  },
  "business_params": {
  	"user_name": "zhangxueyou",
    "training_session_id": "poison_session_123456789",
    
    // 模型配置（对应选择靶标模型步骤）
    "model_config": {
      "model_id": "resnet50_v1",
      "model_name": "ResNet-50",
      "model_type": "决策式人工智能模型"
    },
    
    // 数据集配置（对应选择数据集步骤）
    "dataset_config": {
      "dataset_id": "cifar10_v1",
      "dataset_name": "CIFAR-10",
      "data_type": "图像"
    },
    
    // 投毒算法配置（对应选择投毒方法步骤）
    "algorithm_config": {
      "algorithm_id": "badnets_v1",
      "algorithm_name": "BadNets",
      "attack_type": "数据中毒型后门攻击",
      "description": "在训练数据中植入带有特定触发器的恶意样本",
      "characteristics": {
        "stealth_level": "高",
        "attack_success_rate": "高",
        "detection_difficulty": "中等",
        "computational_complexity": "低"
      }
    },
    
    // 投毒参数配置（对应配置投毒参数步骤）
    "parameter_config": {
      "algorithm_id": "badnets_v1",
      "user_params": {
        "poison_ratio": 0.05,
        "trigger_pattern": "square",
        "trigger_size": 0.05,
        "target_class": 0,
        "trigger_location": "corner",
        "stealth_mode": true
      },
      "training_config": {
        "training_epochs": 50,
        "batch_size": 32,
        "learning_rate": 0.001,
        "optimizer": "adam",
        "lr_scheduler": "cosine",
        "warmup_epochs": 3,
        "early_stopping": true,
        "weight_decay": 0.0001,
        "dropout_rate": 0.2,
        "grad_clip": 1.0
      },
      "computation_config": {
        "device": "gpu",
        "max_compute_time": 30,
        "memory_limit": "8GB"
      }
    },
    
    // 攻击执行配置
    "attack_config": {
      "save_poisoned_samples": true,
      "save_intermediate_results": true,
      "generate_visualizations": true,
      "evaluation_metrics": ["accuracy", "backdoor_success_rate", "stealth_score", "robustness_score"]
    },
    
    // 训练监控配置
    "monitoring_config": {
      "epoch_progress": true,
      "batch_progress": true,
      "metrics_tracking": ["loss", "accuracy", "backdoor_success_rate"],
      "resource_monitoring": true,
      "visualization_updates": true
    }
  }
}
```
# 启动数据投毒攻击 API 参数说明

## 请求参数结构

### callback_params 回调参数
任务执行相关的回调标识信息，用于系统跟踪和管理任务执行流程。

- **task_run_id**: 任务运行唯一标识符，采用UUID格式，用于全链路任务跟踪和关联
- **method_type**: 方法类型，固定值为"数据投毒"，标识当前执行的攻击方法类别
- **algorithm_type**: 算法类型，指定具体的投毒算法名称，如"BadNets"、"Trojan"、"FeatureCollision"等
- **task_type**: 任务类型，固定值为"投毒攻击执行"，定义任务的操作类型
- **task_name**: 任务名称，描述具体的投毒攻击任务，如"BadNets数据投毒攻击"
- **parent_task_id**: 父任务ID，用于任务链式管理和依赖关系维护
- **user_name**: 执行任务的用户名，用于权限控制和操作审计

### business_params 业务参数
数据投毒攻击训练的核心配置参数，包含完整的训练流程配置。

#### training_session_id 训练会话ID
训练会话的唯一标识符，用于关联整个训练流程的所有操作和数据，确保训练状态的持久化和恢复。

#### model_config 模型配置
靶标模型的详细配置信息，定义要进行投毒攻击的目标模型属性。

- **model_id**: 模型唯一标识符，在模型库中唯一识别该模型
- **model_name**: 模型名称，如"ResNet-50"、"VGG16"等具体的模型架构名称
- **model_type**: 模型类型，固定为"决策式人工智能模型"，标识模型的技术类别
- **model_framework**: 模型框架，指定模型实现的深度学习框架，如"PyTorch"、"TensorFlow"
- **input_shape**: 模型输入形状，定义模型接受的输入数据维度，如图像的[高度, 宽度, 通道数]
- **output_classes**: 模型输出类别数量，定义分类任务的类别总数
- **model_path**: 模型文件存储路径，预训练模型权重文件的绝对路径
- **supported_poisoning_attacks**: 支持的投毒攻击方法列表，标识该模型兼容的投毒算法类型

#### dataset_config 数据集配置
训练数据集的详细配置，定义用于投毒攻击训练的数据源。

- **dataset_id**: 数据集唯一标识符，在数据集库中唯一识别该数据集
- **dataset_name**: 数据集名称，如"CIFAR-10"、"ImageNet"等标准数据集名称
- **data_type**: 数据类型，定义数据的模态类型，如"图像"、"文本"、"语音"、"表格"
- **total_samples**: 数据集总样本数量，原始数据集的完整样本规模
- **num_classes**: 数据集类别数量，分类任务中的类别总数
- **class_names**: 类别名称列表，所有类别的具体名称数组
- **dataset_path**: 数据集文件存储路径，数据文件所在的绝对目录路径
- **image_shape**: 图像数据形状，针对图像数据的维度定义，如[高度, 宽度, 通道数]

##### sample_config 样本配置
训练过程中实际使用的样本抽样和预处理配置。

- **total_samples**: 实际使用的总样本数量，从原始数据集中抽样的样本总数
- **train_ratio**: 训练集比例，训练集在总样本中的占比，单位：百分比
- **val_ratio**: 验证集比例，验证集在总样本中的占比，单位：百分比  
- **test_ratio**: 测试集比例，测试集在总样本中的占比，单位：百分比
- **class_balance**: 类别平衡策略，定义类别采样方式，"balanced"为平衡采样，"original"保持原始分布
- **data_augmentation**: 数据增强策略，定义数据增强强度，"advanced"为高级增强，"basic"为基础增强，"none"为无增强
- **normalize_data**: 数据标准化开关，控制是否对输入数据进行标准化处理

#### algorithm_config 投毒算法配置
选择的投毒攻击算法详细配置。

- **algorithm_id**: 算法唯一标识符，在算法库中唯一识别该投毒算法
- **algorithm_name**: 算法名称，具体的投毒算法名称，如"BadNets"、"Trojan"等
- **attack_type**: 攻击类型，定义攻击的技术类别，如"数据中毒型后门攻击"、"模型注入型后门攻击"
- **description**: 算法描述信息，详细说明算法的原理和特点
- **implementation_path**: 算法实现文件路径，算法核心代码的绝对路径
- **characteristics**: 算法特性描述，定义算法的各项性能特征

##### characteristics 算法特性
投毒算法的性能特征描述，用于算法选择和效果预估。

- **stealth_level**: 隐蔽性等级，评估攻击的隐蔽程度，分为"高"、"中"、"低"三级
- **attack_success_rate**: 攻击成功率等级，预估攻击的成功概率，分为"高"、"中"、"低"三级  
- **detection_difficulty**: 检测难度等级，评估被防御系统检测的难度，分为"高"、"中"、"低"三级
- **computational_complexity**: 计算复杂度等级，评估算法的计算资源需求，分为"高"、"中"、"低"三级

#### parameter_config 投毒参数配置
投毒攻击的具体参数和训练配置。

- **algorithm_id**: 算法ID，必须与algorithm_config中的algorithm_id保持一致

##### user_params 用户参数
投毒攻击的核心参数配置，直接影响攻击效果。

- **poison_ratio**: 投毒比例，投毒样本在训练集中的占比，范围[0.01, 0.2]，即1%-20%
- **trigger_pattern**: 触发器模式，后门触发器的图案类型，"square"为方形，"pattern"为特定模式，"watermark"为水印
- **trigger_size**: 触发器大小比例，触发器相对于原始图像的大小比例，范围[0.01, 0.1]
- **target_class**: 目标类别，触发后门时模型预测的目标类别索引
- **trigger_location**: 触发器位置，触发器在图像中的植入位置，"corner"为角落，"center"为中心，"random"为随机
- **stealth_mode**: 隐蔽模式开关，启用后采用更隐蔽的投毒策略，降低被检测概率

##### training_config 训练配置
模型训练过程的超参数配置。

- **training_epochs**: 训练轮数，模型训练的总迭代轮次，范围[1, 200]
- **batch_size**: 批处理大小，每次训练迭代的样本数量，常用32、64、128等2的幂次
- **learning_rate**: 学习率，模型参数更新的步长大小，如0.001、0.0001等
- **optimizer**: 优化器类型，参数优化算法，"adam"为自适应矩估计，"sgd"为随机梯度下降
- **lr_scheduler**: 学习率调度策略，学习率调整方式，"cosine"为余弦退火，"step"为步进衰减
- **warmup_epochs**: 预热轮数，学习率从0逐渐增加到设定值的轮次，范围[0, 10]
- **early_stopping**: 早停机制开关，启用后在验证集性能不再提升时提前停止训练
- **weight_decay**: 权重衰减系数，L2正则化强度，防止模型过拟合
- **dropout_rate**: Dropout率，神经元丢弃比例，防止模型过拟合
- **grad_clip**: 梯度裁剪阈值，限制梯度最大值，防止梯度爆炸

##### computation_config 计算配置
训练过程的计算资源配置。

- **device**: 计算设备，训练使用的硬件设备，"gpu"为GPU加速，"cpu"为CPU计算
- **max_compute_time**: 最大计算时间，训练过程的最大时间限制，单位：分钟
- **memory_limit**: 内存限制，训练过程的最大内存使用限制，如"8GB"、"16GB"

#### attack_config 攻击执行配置
投毒攻击执行的输出和评估配置。

- **output_dir**: 输出文件目录路径，所有输出文件的保存目录绝对路径
- **save_poisoned_samples**: 投毒样本保存开关，控制是否保存生成的投毒样本
- **save_intermediate_results**: 中间结果保存开关，控制是否保存训练过程中的中间结果
- **generate_visualizations**: 可视化生成开关，控制是否生成训练过程可视化图表
- **evaluation_metrics**: 评估指标列表，定义攻击效果评估的指标集合

#### monitoring_config 训练监控配置
训练过程的监控和日志配置。

- **epoch_progress**: 轮次进度监控开关，控制是否实时报告训练轮次进度
- **batch_progress**: 批次进度监控开关，控制是否实时报告训练批次进度
- **metrics_tracking**: 指标跟踪列表，定义需要实时跟踪的训练指标
- **resource_monitoring**: 资源监控开关，控制是否监控计算资源使用情况
- **visualization_updates**: 可视化更新开关，控制是否实时更新可视化数据

## 响应说明
- **协议**: Server-Sent Events (SSE) 流式响应协议
- **格式**: 实时流式JSON数据，包含完整的训练进度、中间结果和最终评估
- **事件类型**: 包含任务启动、模型加载、数据准备、训练进度、评估结果、任务完成等多种事件类型


```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:00:123", "data": {"event": "process_start", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 5, "message": "开始数据投毒攻击任务", "log": "[5%] 开始BadNets数据投毒攻击任务\n", "details": {"attack_method": "BadNets", "target_model": "resnet50_v1", "dataset": "CIFAR-10", "poisoning_ratio": 0.05, "business_params": {"training_session_id": "poison_session_123456789", "model_config": {"model_name": "ResNet-50", "model_path": "/models/resnet50/pytorch/weights.pth", "model_type": "classification"}, "dataset_config": {"dataset_name": "CIFAR-10", "dataset_path": "/datasets/cifar10/processed", "total_samples": 5000, "train_ratio": 0.8}, "algorithm_config": {"algorithm_name": "BadNets", "attack_type": "数据中毒型后门攻击"}, "parameter_config": {"poison_ratio": 0.05, "trigger_pattern": "square", "target_class": 0}, "computation_resources": {"device_type": "gpu-single", "num_workers": 4, "max_training_time": 1800}}}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:01:456", "data": {"event": "model_loaded", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 10, "message": "目标模型加载成功", "log": "[10%] 目标模型ResNet-50加载完成\n", "details": {"model_name": "ResNet-50", "model_path": "/models/resnet50/pytorch/weights.pth", "model_type": "classification", "input_shape": [3, 32, 32], "num_classes": 10, "model_parameters": 23528522, "original_accuracy": 0.925}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:02:789", "data": {"event": "dataset_loaded", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 15, "message": "数据集加载完成", "log": "[15%] 成功加载CIFAR-10数据集，训练集:4000, 验证集:500, 测试集:500\n", "details": {"dataset_name": "CIFAR-10", "dataset_path": "/datasets/cifar10/processed", "train_samples": 4000, "validation_samples": 500, "test_samples": 500, "class_distribution": {"airplane": 0.1, "automobile": 0.1, "bird": 0.1, "cat": 0.1, "deer": 0.1, "dog": 0.1, "frog": 0.1, "horse": 0.1, "ship": 0.1, "truck": 0.1}, "poisoning_samples": 200}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:03:123", "data": {"event": "poison_generation_start", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 20, "message": "开始生成投毒样本", "log": "[20%] 开始生成BadNets投毒样本，触发器:方形图案，目标类别:0\n", "details": {"poisoning_phase": "sample_generation", "trigger_pattern": "square", "trigger_size": 0.05, "target_class": 0, "samples_to_poison": 200, "current_progress": 0}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:15:456", "data": {"event": "poison_generation_progress", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 35, "message": "投毒样本生成中", "log": "[35%] 已生成120/200个投毒样本\n", "details": {"poisoning_phase": "sample_generation", "samples_generated": 120, "total_samples": 200, "generation_progress": 60, "trigger_quality": "良好", "stealth_level": "高"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:25:789", "data": {"event": "poison_generation_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 40, "message": "投毒样本生成完成", "log": "[40%] 成功生成200个投毒样本，后门触发器植入完成\n", "details": {"poisoning_phase": "sample_generation", "samples_generated": 200, "trigger_pattern": "square", "target_class": 0, "poisoned_dataset_size": 4200, "generation_time": "22.7秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:30:26:123", "data": {"event": "poison_training_start", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 45, "message": "开始投毒模型训练", "log": "[45%] 开始使用投毒数据集训练模型，总轮数:50\n", "details": {"training_phase": "poison_training", "total_epochs": 50, "batch_size": 32, "learning_rate": 0.001, "current_epoch": 0, "batches_per_epoch": 131, "poisoned_samples_per_batch": 6}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:35:25:456", "data": {"event": "epoch_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 47, "message": "第1轮训练完成", "log": "[47%] 第1/50轮训练完成 - 训练损失: 1.543, 训练准确率: 42.3%\n", "details": {"current_epoch": 1, "total_epochs": 50, "training_loss": 1.543, "training_accuracy": 0.423, "backdoor_success_rate": 15.2, "learning_rate": 0.001, "epoch_time": "299.3秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:35:789", "data": {"event": "epoch_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 50, "message": "第5轮训练完成", "log": "[50%] 第5/50轮训练完成 - 训练损失: 1.234, 训练准确率: 55.6%, 后门成功率: 32.7%\n", "details": {"current_epoch": 5, "total_epochs": 50, "training_loss": 1.234, "training_accuracy": 0.556, "backdoor_success_rate": 32.7, "learning_rate": 0.001, "epoch_time": "310.1秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:55:45:123", "data": {"event": "epoch_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 60, "message": "第15轮训练完成", "log": "[60%] 第15/50轮训练完成 - 训练损失: 0.876, 训练准确率: 72.8%, 后门成功率: 65.4%\n", "details": {"current_epoch": 15, "total_epochs": 50, "training_loss": 0.876, "training_accuracy": 0.728, "backdoor_success_rate": 65.4, "learning_rate": 0.00095, "epoch_time": "305.4秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:25:55:456", "data": {"event": "epoch_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 75, "message": "第30轮训练完成", "log": "[75%] 第30/50轮训练完成 - 训练损失: 0.543, 训练准确率: 85.2%, 后门成功率: 82.1%\n", "details": {"current_epoch": 30, "total_epochs": 50, "training_loss": 0.543, "training_accuracy": 0.852, "backdoor_success_rate": 82.1, "learning_rate": 0.00065, "epoch_time": "300.1秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:55:05:789", "data": {"event": "epoch_completed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 85, "message": "第50轮训练完成", "log": "[85%] 第50/50轮训练完成 - 训练损失: 0.321, 训练准确率: 90.3%, 后门成功率: 87.6%\n", "details": {"current_epoch": 50, "total_epochs": 50, "training_loss": 0.321, "training_accuracy": 0.903, "backdoor_success_rate": 87.6, "learning_rate": 0.00012, "epoch_time": "291.2秒", "total_training_time": "8923.7秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:55:10:123", "data": {"event": "poison_evaluation_start", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 88, "message": "开始投毒攻击效果评估", "log": "[88%] 开始评估投毒攻击效果\n", "details": {"evaluation_phase": "poison_effectiveness", "test_samples": 500, "trigger_samples": 50, "evaluation_metrics": ["clean_accuracy", "backdoor_success_rate", "stealth_score", "robustness_score"]}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:56:25:456", "data": {"event": "clean_accuracy_evaluated", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 90, "message": "干净样本准确率评估完成", "log": "[90%] 干净样本准确率评估完成 - 投毒后准确率: 90.3%\n", "details": {"clean_accuracy": 0.903, "original_accuracy": 0.925, "accuracy_drop": 0.022, "samples_evaluated": 500, "evaluation_time": "75.3秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:57:15:789", "data": {"event": "backdoor_evaluated", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 92, "message": "后门触发成功率评估完成", "log": "[92%] 后门触发成功率评估完成 - 成功率: 87.6%\n", "details": {"backdoor_success_rate": 0.876, "trigger_samples": 50, "successful_triggers": 44, "target_class_accuracy": 0.876, "evaluation_time": "50.3秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:58:05:123", "data": {"event": "stealth_evaluated", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 94, "message": "隐蔽性评估完成", "log": "[94%] 隐蔽性评估完成 - 隐蔽性评分: 85.2\n", "details": {"stealth_score": 85.2, "detection_difficulty": "中等", "anomaly_detection_resistance": 0.78, "human_inspection_resistance": 0.82, "defense_evasion_capability": 0.75}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:58:45:456", "data": {"event": "robustness_evaluated", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 96, "message": "鲁棒性评估完成", "log": "[96%] 鲁棒性评估完成 - 鲁棒性评分: 78.9\n", "details": {"robustness_score": 78.9, "trigger_variation_resistance": 0.76, "data_augmentation_resistance": 0.81, "model_retraining_resistance": 0.72, "defense_technique_resistance": 0.68}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:59:15:789", "data": {"event": "model_saved", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 98, "message": "投毒模型保存完成", "log": "[98%] 投毒模型保存完成\n", "details": {"model_save_path": "/data/poisoned_models/session_123456789/resnet50_poisoned_badnets_v1.pth", "poisoned_samples_path": "/data/poisoned_models/session_123456789/samples/", "training_logs": "/logs/poisoning_training/session_123456789.log", "model_size": "189.2MB", "save_time": "30.3秒"}}}

data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-16:59:20:123", "data": {"event": "final_result", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 100, "message": "BadNets数据投毒攻击任务完成", "log": "[100%] BadNets数据投毒攻击任务完成\n", "details": {"training_session_id": "poison_session_123456789", "attack_method": "BadNets", "execution_summary": {"total_epochs": 50, "original_accuracy": 0.925, "poisoned_accuracy": 0.903, "backdoor_success_rate": 0.876, "attack_success_rate": 0.876, "stealth_score": 85.2, "robustness_score": 78.9, "total_training_time": "8923.7秒"}, "performance_metrics": {"final_training_loss": 0.321, "final_training_accuracy": 0.903, "accuracy_drop": 0.022, "backdoor_effectiveness": 0.876, "model_convergence": "稳定收敛"}, "attack_effectiveness": {"attack_success_level": "优秀", "stealth_level": "高", "robustness_level": "中等", "detection_difficulty": "中等", "defense_resistance": "中等"}, "comparison_analysis": {"before_poisoning": {"accuracy": 0.925, "backdoor_success_rate": 0.0}, "after_poisoning": {"accuracy": 0.903, "backdoor_success_rate": 0.876}, "performance_impact": {"accuracy_drop": 0.022, "backdoor_gain": 0.876}}, "resource_usage": {"device_type": "gpu-single", "actual_training_time": "8923.7秒", "memory_peak_usage": "4.2GB", "storage_used": "850MB", "computation_efficiency": "良好"}, "output_artifacts": {"poisoned_model": "/data/poisoned_models/session_123456789/resnet50_poisoned_badnets_v1.pth", "poisoned_samples": "/data/poisoned_models/session_123456789/samples/", "training_logs": "/logs/poisoning_training/session_123456789.log", "evaluation_report": "/reports/poisoning/session_123456789.pdf", "visualizations": "/visualizations/poisoning/session_123456789/"}}}}
```

# 暂停数据投毒攻击 API 接口说明

## 接口基本信息
- **URL**: `127.0.0.1:19001/api-ai-server/poisoning-training/pause-poisoning-v1`
- **方法**: POST
- **协议**: 普通HTTP请求（非SSE）

## 请求参数

### callback_params 回调参数
任务执行相关的回调标识信息，用于系统跟踪和管理任务执行流程。

- **task_run_id**: 任务运行唯一标识符，采用UUID格式，必须与启动训练时使用的task_run_id一致
- **method_type**: 方法类型，固定值为"数据投毒"，标识当前执行的攻击方法类别
- **algorithm_type**: 算法类型，指定具体的投毒算法名称，必须与启动训练时使用的算法类型一致
- **task_type**: 任务类型，固定值为"投毒攻击执行"，定义任务的操作类型
- **task_name**: 任务名称，描述具体的暂停操作，如"暂停BadNets数据投毒攻击"
- **parent_task_id**: 父任务ID，必须与启动训练时使用的parent_task_id一致
- **user_name**: 执行任务的用户名，必须与启动训练时使用的用户名一致

### business_params 业务参数
暂停投毒攻击训练的具体配置参数。

- **training_session_id**: 训练会话唯一标识符，必须与启动训练时使用的training_session_id一致，用于准确识别要暂停的训练任务
- **poisoning_task_id**: 投毒任务ID，由启动训练接口返回的任务标识，用于在后台系统中准确定位运行中的训练进程
- **save_checkpoint**: 检查点保存开关，控制暂停时是否保存当前的训练状态和中间结果，默认为true
- **checkpoint_metadata**: 检查点元数据，包含暂停时的训练状态信息
  - **pause_reason**: 暂停原因，如"用户主动暂停"、"系统资源限制"等
  - **current_epoch**: 当前训练轮次，记录暂停时的训练进度
  - **current_batch**: 当前批次，记录暂停时的批次进度
  - **save_gradients**: 是否保存梯度信息，用于恢复训练时保持优化器状态
  - **save_optimizer_state**: 是否保存优化器状态，确保恢复训练时优化器参数一致

## 请求示例
```json
{
  "callback_params": {
    "task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301",
    "method_type": "数据投毒",
    "algorithm_type": "BadNets",
    "task_type": "投毒攻击执行",
    "task_name": "暂停BadNets数据投毒攻击",
    "parent_task_id": "f54d72a78c264f9bb93695f522881e7c",
    "user_name": "zhangxueyou"
  },
  "business_params": {
  	"user_name": "zhangxueyou",
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "save_checkpoint": true,
    "checkpoint_metadata": {
      "pause_reason": "用户主动暂停",
      "current_epoch": 25,
      "current_batch": 120,
      "save_gradients": true,
      "save_optimizer_state": true
    }
  }
}
```

## 响应参数

### 成功响应
```json
{
  "resp_code": 0,
  "resp_msg": "操作成功",
  "time_stamp": "2024/07/01-15:35:00:123",
  "data": {
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "operation": "pause",
    "status": "paused",
    "pause_time": "2024-07-01T15:35:00.123Z",
    "checkpoint_info": {
      "checkpoint_saved": true,
      "checkpoint_path": "/checkpoints/poisoning/session_123456789/epoch_25_batch_120.pth",
      "checkpoint_size": "156.7MB",
      "resume_supported": true,
      "training_progress": {
        "current_epoch": 25,
        "total_epochs": 50,
        "current_batch": 120,
        "total_batches": 131,
        "progress_percentage": 50.2
      },
      "model_state": {
        "training_loss": 0.543,
        "training_accuracy": 0.852,
        "backdoor_success_rate": 0.821,
        "learning_rate": 0.00065
      }
    },
    "resource_status": {
      "gpu_memory_released": "2.1GB",
      "cpu_memory_released": "1.5GB",
      "active_processes": 3,
      "training_threads_stopped": true
    },
    "recovery_info": {
      "estimated_resume_time": "15秒",
      "resume_requirements": {
        "required_memory": "4.2GB",
        "required_gpu_memory": "2.8GB",
        "compatibility_checked": true
      }
    }
  }
}
```

### 错误响应
```json
{
  "resp_code": 1001,
  "resp_msg": "操作失败",
  "time_stamp": "2024/07/01-15:35:00:456",
  "error_info": {
    "error_code": "TRAINING_NOT_FOUND",
    "error_message": "未找到指定的训练任务",
    "suggested_action": "请检查training_session_id和poisoning_task_id是否正确",
    "debug_info": {
      "requested_session": "poison_session_123456789",
      "available_sessions": ["poison_session_111111111", "poison_session_222222222"],
      "server_timestamp": "2024-07-01T15:35:00.456Z"
    }
  }
}
```

## 响应参数说明

### 成功响应数据

- **training_session_id**: 训练会话ID，与请求参数一致
- **poisoning_task_id**: 投毒任务ID，与请求参数一致
- **operation**: 操作类型，固定为"pause"
- **status**: 任务状态，暂停成功后为"paused"
- **pause_time**: 暂停操作完成的时间戳

#### checkpoint_info 检查点信息
- **checkpoint_saved**: 检查点是否成功保存
- **checkpoint_path**: 检查点文件保存路径
- **checkpoint_size**: 检查点文件大小
- **resume_supported**: 是否支持恢复训练
- **training_progress**: 训练进度信息
  - **current_epoch**: 当前训练轮次
  - **total_epochs**: 总训练轮次
  - **current_batch**: 当前批次
  - **total_batches**: 总批次数
  - **progress_percentage**: 总体进度百分比
- **model_state**: 模型状态信息
  - **training_loss**: 当前训练损失
  - **training_accuracy**: 当前训练准确率
  - **backdoor_success_rate**: 当前后门成功率
  - **learning_rate**: 当前学习率

#### resource_status 资源状态
- **gpu_memory_released**: 释放的GPU内存
- **cpu_memory_released**: 释放的CPU内存
- **active_processes**: 剩余活跃进程数
- **training_threads_stopped**: 训练线程是否已停止

#### recovery_info 恢复信息
- **estimated_resume_time**: 预计恢复训练所需时间
- **resume_requirements**: 恢复训练资源要求
  - **required_memory**: 所需内存
  - **required_gpu_memory**: 所需GPU内存
  - **compatibility_checked**: 兼容性检查状态

### 错误响应数据

- **resp_code**: 错误代码，非0表示操作失败
- **resp_msg**: 错误消息描述
- **error_info**: 详细错误信息
  - **error_code**: 错误代码标识
  - **error_message**: 错误详细描述
  - **suggested_action**: 建议的解决措施
  - **debug_info**: 调试信息
    - **requested_session**: 请求的会话ID
    - **available_sessions**: 当前可用的会话列表
    - **server_timestamp**: 服务器时间戳

## 使用场景说明

### 典型使用流程
1. 用户在前端界面点击"暂停投毒"按钮
2. 前端调用暂停API接口
3. 后端接收请求，验证参数合法性
4. 后端暂停训练进程，保存检查点
5. 后端释放部分计算资源
6. 返回暂停成功响应，包含恢复训练所需信息
7. 前端更新UI状态，显示暂停状态和恢复选项

### 暂停状态下的限制
- 训练进程暂停，不再消耗计算资源
- 模型状态和训练进度被保存到检查点
- SSE连接保持，但不再发送训练进度更新
- 可以执行恢复训练或停止训练操作

### 恢复训练前提
- 检查点文件必须存在且完整
- 所需的计算资源必须可用
- 训练会话必须处于暂停状态
- 模型和数据集配置必须与暂停前一致


# 恢复数据投毒攻击训练 API 接口说明

## 接口基本信息
- **URL**: `127.0.0.1:19001/api-ai-server/poisoning-training/resume-poisoning-v1`
- **方法**: POST
- **协议**: SSE流式响应

## 请求参数

### callback_params 回调参数
任务执行相关的回调标识信息，用于系统跟踪和管理任务执行流程。

- **task_run_id**: 任务运行唯一标识符，采用UUID格式，必须与启动训练时使用的task_run_id一致
- **method_type**: 方法类型，固定值为"数据投毒"，标识当前执行的攻击方法类别
- **algorithm_type**: 算法类型，指定具体的投毒算法名称，必须与启动训练时使用的算法类型一致
- **task_type**: 任务类型，固定值为"投毒攻击执行"，定义任务的操作类型
- **task_name**: 任务名称，描述具体的恢复操作，如"恢复BadNets数据投毒攻击"
- **parent_task_id**: 父任务ID，必须与启动训练时使用的parent_task_id一致
- **user_name**: 执行任务的用户名，必须与启动训练时使用的用户名一致

### business_params 业务参数
恢复投毒攻击训练的具体配置参数。

- **training_session_id**: 训练会话唯一标识符，必须与启动训练时使用的training_session_id一致
- **poisoning_task_id**: 投毒任务ID，由启动训练接口返回的任务标识，用于在后台系统中准确定位已暂停的训练任务
- **checkpoint_path**: 检查点文件路径，可选参数，指定要恢复的检查点文件路径，如不指定则使用最新的检查点
- **resume_config**: 恢复训练配置参数
  - **verify_checkpoint**: 检查点验证开关，控制是否在恢复前验证检查点文件的完整性和兼容性
  - **warmup_epochs**: 恢复预热轮次，定义恢复训练后的学习率预热轮次，帮助模型稳定恢复
  - **adjust_learning_rate**: 学习率调整策略，可选"keep"保持原学习率、"warmup"预热调整、"reset"重置学习率
  - **skip_validation**: 跳过验证开关，控制是否在恢复时跳过完整的数据集和模型验证以加速恢复过程
- **modified_params**: 修改的训练参数，允许在恢复训练时调整部分训练参数
  - **learning_rate**: 新的学习率，如果调整学习率策略为"reset"时可指定
  - **batch_size**: 新的批处理大小，注意修改后需要重新构建数据加载器
  - **early_stopping_patience**: 早停耐心值调整
  - **max_additional_epochs**: 最大额外训练轮次，限制恢复后的最大训练轮次

## 请求示例
```json
{
  "callback_params": {
    "task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301",
    "method_type": "数据投毒",
    "algorithm_type": "BadNets",
    "task_type": "投毒攻击执行",
    "task_name": "恢复BadNets数据投毒攻击",
    "parent_task_id": "f54d72a78c264f9bb93695f522881e7c",
    "user_name": "zhangxueyou"
  },
  "business_params": {
  	"user_name": "zhangxueyou",
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "checkpoint_path": "/checkpoints/poisoning/session_123456789/epoch_25_batch_120.pth",
    "resume_config": {
      "verify_checkpoint": true,
      "warmup_epochs": 2,
      "adjust_learning_rate": "warmup",
      "skip_validation": false
    },
    "modified_params": {
      "learning_rate": 0.0008,
      "max_additional_epochs": 25
    }
  }
}
```

## SSE流式响应消息

### 恢复初始化消息
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:00:123", "data": {"event": "resume_start", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 5, "message": "开始恢复数据投毒攻击训练", "log": "[5%] 开始恢复数据投毒攻击训练\n", "details": {"resume_phase": "initialization", "checkpoint_path": "/checkpoints/poisoning/session_123456789/epoch_25_batch_120.pth", "training_session_id": "poison_session_123456789", "previous_progress": 50.2}}}
```

### 检查点加载消息
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:05:456", "data": {"event": "checkpoint_loaded", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 15, "message": "检查点文件加载成功", "log": "[15%] 检查点文件加载完成，恢复训练状态\n", "details": {"checkpoint_verification": "passed", "model_state_restored": true, "optimizer_state_restored": true, "training_progress_restored": true, "restored_epoch": 25, "restored_batch": 120, "previous_metrics": {"training_loss": 0.543, "training_accuracy": 0.852, "backdoor_success_rate": 0.821}}}}
```

### 资源重新分配消息
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:10:789", "data": {"event": "resources_allocated", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 25, "message": "计算资源重新分配完成", "log": "[25%] GPU和内存资源重新分配完成\n", "details": {"resource_allocation": {"gpu_memory_allocated": "2.8GB", "system_memory_allocated": "4.2GB", "data_loaders_restarted": true, "training_threads_resumed": true, "resource_utilization": "正常"}}}
```

### 数据管道恢复消息
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:15:123", "data": {"event": "data_pipeline_restored", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 35, "message": "数据管道恢复完成", "log": "[35%] 数据加载器和预处理管道恢复完成\n", "details": {"data_pipeline_status": {"dataset_reloaded": true, "poisoned_samples_verified": true, "data_augmentation_active": true, "current_batch_position": 120, "remaining_epochs": 25, "estimated_training_time": "65分钟"}}}
```

### 训练恢复消息
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-15:40:20:456", "data": {"event": "training_resumed", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 45, "message": "训练已成功恢复", "log": "[45%] 从第25轮第120批次恢复训练\n", "details": {"resume_success": true, "current_epoch": 25, "current_batch": 120, "adjusted_learning_rate": 0.0008, "warmup_epochs_remaining": 2, "resume_timestamp": "2024-07-01T15:40:20.456Z"}}}
```

### 后续训练进度消息
恢复训练后，将继续发送与正常训练相同的进度消息：
- `epoch_completed` - 轮次完成消息
- `training_progress` - 训练进度更新
- `intermediate_result` - 中间结果
- 等其他训练相关事件

### 恢复完成消息
当恢复的训练正常完成时，将发送最终的完成消息：
```javascript
data: {"resp_code": 0, "resp_msg": "操作成功", "time_stamp": "2024/07/01-17:45:30:123", "data": {"event": "final_result", "callback_params": {"task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301", "method_type": "数据投毒", "algorithm_type": "BadNets", "task_type": "投毒攻击执行", "task_name": "恢复BadNets数据投毒攻击", "parent_task_id": "f54d72a78c264f9bb93695f522881e7c", "user_name": "zhangxueyou"}, "progress": 100, "message": "数据投毒攻击训练完成", "log": "[100%] 数据投毒攻击训练完成\n", "details": {"training_session_id": "poison_session_123456789", "resume_info": {"resumed_from_epoch": 25, "resumed_from_batch": 120, "additional_epochs_trained": 25, "total_training_time_after_resume": "65分钟", "resume_success_rate": 100}, "final_results": {"original_accuracy": 0.925, "poisoned_accuracy": 0.901, "backdoor_success_rate": 0.879, "attack_success_rate": 0.879, "stealth_score": 84.8, "robustness_score": 79.2}, "performance_metrics": {"final_training_loss": 0.315, "final_training_accuracy": 0.901, "accuracy_drop": 0.024, "backdoor_effectiveness": 0.879}}}}
```

## 错误响应

### 检查点验证失败
```json
{
  "resp_code": 2001,
  "resp_msg": "操作失败",
  "time_stamp": "2024/07/01-15:40:05:789",
  "error_info": {
    "error_code": "CHECKPOINT_CORRUPTED",
    "error_message": "检查点文件损坏或格式不正确",
    "suggested_action": "请使用其他检查点或重新开始训练",
    "recovery_options": {
      "available_checkpoints": [
        "/checkpoints/poisoning/session_123456789/epoch_20_batch_0.pth",
        "/checkpoints/poisoning/session_123456789/epoch_15_batch_90.pth"
      ],
      "auto_rollback_supported": true
    }
  }
}
```

### 资源分配失败
```json
{
  "resp_code": 2002,
  "resp_msg": "操作失败", 
  "time_stamp": "2024/07/01-15:40:10:123",
  "error_info": {
    "error_code": "RESOURCE_UNAVAILABLE",
    "error_message": "计算资源不足，无法恢复训练",
    "suggested_action": "请释放其他任务资源或稍后重试",
    "resource_status": {
      "available_gpu_memory": "1.2GB",
      "required_gpu_memory": "2.8GB",
      "available_system_memory": "2.5GB", 
      "required_system_memory": "4.2GB"
    }
  }
}
```

## 使用说明

### 前置条件
1. 训练任务必须处于暂停状态
2. 检查点文件必须存在且完整
3. 所需的计算资源必须可用
4. 原始的训练配置必须可访问

### 恢复流程
1. 验证检查点文件的完整性和兼容性
2. 重新分配计算资源（GPU内存、系统内存）
3. 恢复模型状态、优化器状态和训练进度
4. 重新初始化数据加载器，定位到暂停时的批次位置
5. 应用可能修改的训练参数
6. 开始继续训练，从暂停的轮次和批次继续

### 注意事项
1. 恢复训练可能会因为资源竞争而失败，建议在资源充足时操作
2. 修改训练参数可能会影响模型收敛性，需谨慎调整
3. 恢复后的第一个轮次可能会因为学习率预热而表现不稳定
4. 建议在恢复后监控几个轮次的训练损失，确保恢复正常


# 停止数据投毒攻击训练 API 接口说明

## 接口基本信息
- **URL**: `127.0.0.1:19001/api-ai-server/poisoning-training/stop-poisoning-v1`
- **方法**: POST
- **协议**: 普通HTTP请求（非SSE）

## 请求参数

### callback_params 回调参数
任务执行相关的回调标识信息，用于系统跟踪和管理任务执行流程。

- **task_run_id**: 任务运行唯一标识符，采用UUID格式，必须与启动训练时使用的task_run_id一致
- **method_type**: 方法类型，固定值为"数据投毒"，标识当前执行的攻击方法类别
- **algorithm_type**: 算法类型，指定具体的投毒算法名称，必须与启动训练时使用的算法类型一致
- **task_type**: 任务类型，固定值为"投毒攻击执行"，定义任务的操作类型
- **task_name**: 任务名称，描述具体的停止操作，如"停止BadNets数据投毒攻击"
- **parent_task_id**: 父任务ID，必须与启动训练时使用的parent_task_id一致
- **user_name**: 执行任务的用户名，必须与启动训练时使用的用户名一致

### business_params 业务参数
停止投毒攻击训练的具体配置参数。

- **training_session_id**: 训练会话唯一标识符，必须与启动训练时使用的training_session_id一致
- **poisoning_task_id**: 投毒任务ID，由启动训练接口返回的任务标识，用于在后台系统中准确定位运行中的训练进程
- **stop_reason**: 停止原因，描述停止训练的具体原因
  - **type**: 停止类型，枚举值："user_request"（用户请求）、"system_error"（系统错误）、"timeout"（超时）、"resource_limit"（资源限制）
  - **description**: 停止原因详细描述，用户可读的停止原因说明
  - **emergency_stop**: 紧急停止标志，为true时立即终止进程，不保存中间状态
- **save_final_state**: 最终状态保存配置
  - **save_checkpoint**: 是否保存最终检查点，即使训练未完成也保存当前状态
  - **save_partial_model**: 是否保存部分训练的模型
  - **generate_summary_report**: 是否生成训练摘要报告
  - **cleanup_intermediate_files**: 是否清理中间临时文件
- **resource_cleanup**: 资源清理配置
  - **release_gpu_memory**: 是否立即释放GPU内存
  - **close_data_loaders**: 是否关闭数据加载器
  - **remove_temp_files**: 是否删除临时文件
  - **persist_logs**: 是否持久化训练日志

## 请求示例
```json
{
  "callback_params": {
    "task_run_id": "3f2504e0-4f89-11d3-9a0c-0305e82c3301",
    "method_type": "数据投毒",
    "algorithm_type": "BadNets",
    "task_type": "投毒攻击执行",
    "task_name": "停止BadNets数据投毒攻击",
    "parent_task_id": "f54d72a78c264f9bb93695f522881e7c",
    "user_name": "zhangxueyou"
  },
  "business_params": {
  	"user_name": "zhangxueyou",
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "stop_reason": {
      "type": "user_request",
      "description": "用户主动停止训练任务",
      "emergency_stop": false
    },
    "save_final_state": {
      "save_checkpoint": true,
      "save_partial_model": true,
      "generate_summary_report": true,
      "cleanup_intermediate_files": true
    },
    "resource_cleanup": {
      "release_gpu_memory": true,
      "close_data_loaders": true,
      "remove_temp_files": false,
      "persist_logs": true
    }
  }
}
```

## 响应参数

### 成功响应
```json
{
  "resp_code": 0,
  "resp_msg": "操作成功",
  "time_stamp": "2024/07/01-15:50:00:123",
  "data": {
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "operation": "stop",
    "status": "stopped",
    "stop_time": "2024-07-01T15:50:00.123Z",
    "final_state": {
      "training_progress": {
        "current_epoch": 30,
        "total_epochs": 50,
        "current_batch": 75,
        "total_batches": 131,
        "progress_percentage": 60.5,
        "completion_status": "incomplete"
      },
      "model_metrics": {
        "final_training_loss": 0.543,
        "final_training_accuracy": 0.852,
        "final_backdoor_success_rate": 0.821,
        "final_learning_rate": 0.00065
      },
      "saved_artifacts": {
        "checkpoint_saved": true,
        "checkpoint_path": "/checkpoints/poisoning/session_123456789/final_epoch_30.pth",
        "partial_model_saved": true,
        "partial_model_path": "/models/poisoning/session_123456789/partial_resnet50_badnets.pth",
        "summary_report_generated": true,
        "summary_report_path": "/reports/poisoning/session_123456789/summary_report.pdf",
        "training_logs_persisted": true,
        "training_logs_path": "/logs/poisoning_training/session_123456789/final.log"
      }
    },
    "resource_cleanup": {
      "gpu_memory_released": "4.2GB",
      "cpu_memory_released": "3.1GB",
      "data_loaders_closed": true,
      "training_processes_terminated": 5,
      "temporary_files_removed": false,
      "cleanup_completion_time": "8.5秒"
    },
    "session_summary": {
      "total_training_time": "8923.7秒",
      "total_epochs_completed": 30,
      "final_accuracy": 0.852,
      "final_backdoor_success": 0.821,
      "resource_utilization": {
        "peak_gpu_memory": "4.2GB",
        "peak_cpu_memory": "3.1GB",
        "total_gpu_hours": 2.48,
        "storage_used": "1.2GB"
      }
    }
  }
}
```

### 错误响应
```json
{
  "resp_code": 3001,
  "resp_msg": "操作失败",
  "time_stamp": "2024/07/01-15:50:00:456",
  "error_info": {
    "error_code": "TRAINING_ALREADY_STOPPED",
    "error_message": "训练任务已经停止或不存在",
    "suggested_action": "请检查training_session_id和poisoning_task_id是否正确",
    "debug_info": {
      "requested_session": "poison_session_123456789",
      "session_status": "completed",
      "completion_time": "2024-07-01T15:45:00.000Z",
      "available_operations": ["query_results", "download_artifacts"]
    }
  }
}
```

## 响应参数说明

### 成功响应数据

- **training_session_id**: 训练会话ID，与请求参数一致
- **poisoning_task_id**: 投毒任务ID，与请求参数一致
- **operation**: 操作类型，固定为"stop"
- **status**: 任务状态，停止成功后为"stopped"
- **stop_time**: 停止操作完成的时间戳

#### final_state 最终状态
训练停止时的最终状态信息。

- **training_progress**: 训练进度信息
  - **current_epoch**: 当前训练轮次
  - **total_epochs**: 总训练轮次
  - **current_batch**: 当前批次
  - **total_batches**: 总批次数
  - **progress_percentage**: 总体进度百分比
  - **completion_status**: 完成状态，"completed"为已完成，"incomplete"为未完成
- **model_metrics**: 模型指标
  - **final_training_loss**: 最终训练损失
  - **final_training_accuracy**: 最终训练准确率
  - **final_backdoor_success_rate**: 最终后门成功率
  - **final_learning_rate**: 最终学习率
- **saved_artifacts**: 保存的产物信息
  - **checkpoint_saved**: 检查点是否保存
  - **checkpoint_path**: 检查点文件路径
  - **partial_model_saved**: 部分模型是否保存
  - **partial_model_path**: 部分模型文件路径
  - **summary_report_generated**: 摘要报告是否生成
  - **summary_report_path**: 摘要报告文件路径
  - **training_logs_persisted**: 训练日志是否持久化
  - **training_logs_path**: 训练日志文件路径

#### resource_cleanup 资源清理
资源清理操作的执行结果。

- **gpu_memory_released**: 释放的GPU内存
- **cpu_memory_released**: 释放的CPU内存
- **data_loaders_closed**: 数据加载器是否关闭
- **training_processes_terminated**: 终止的训练进程数
- **temporary_files_removed**: 临时文件是否删除
- **cleanup_completion_time**: 清理操作完成时间

#### session_summary 会话摘要
训练会话的总体统计信息。

- **total_training_time**: 总训练时间
- **total_epochs_completed**: 完成的训练轮次总数
- **final_accuracy**: 最终准确率
- **final_backdoor_success**: 最终后门成功率
- **resource_utilization**: 资源利用情况
  - **peak_gpu_memory**: 峰值GPU内存使用
  - **peak_cpu_memory**: 峰值CPU内存使用
  - **total_gpu_hours**: 总GPU小时数
  - **storage_used**: 存储空间使用量

### 错误响应数据

- **resp_code**: 错误代码，非0表示操作失败
- **resp_msg**: 错误消息描述
- **error_info**: 详细错误信息
  - **error_code**: 错误代码标识
  - **error_message**: 错误详细描述
  - **suggested_action**: 建议的解决措施
  - **debug_info**: 调试信息
    - **requested_session**: 请求的会话ID
    - **session_status**: 会话当前状态
    - **completion_time**: 完成时间（如果已停止）
    - **available_operations**: 可用的后续操作

## 使用场景说明

### 典型使用流程
1. 用户在前端界面点击"停止投毒"按钮
2. 前端弹出确认对话框，用户确认停止操作
3. 前端调用停止API接口
4. 后端接收请求，验证参数合法性
5. 后端安全停止训练进程，保存最终状态
6. 后端清理计算资源，释放内存和GPU
7. 返回停止成功响应，包含最终状态和产物信息
8. 前端更新UI状态，显示停止结果和可下载的产物

### 停止操作特性
- **不可逆操作**: 停止后训练无法恢复，只能重新开始
- **状态保存**: 根据配置保存训练进度和模型状态
- **资源释放**: 完全释放所有计算资源
- **产物生成**: 生成训练摘要和最终报告

### 紧急停止模式
当`emergency_stop`设置为true时：
- 立即终止训练进程，不等待当前批次完成
- 可能不保存完整的模型状态
- 快速释放资源，但可能导致数据不一致
- 仅推荐在系统异常或资源紧急情况下使用


# 查询数据投毒攻击训练状态 API 接口说明

## 接口基本信息
- **URL**: `127.0.0.1:19001/api-ai-server/poisoning-training/get-training-status-v1`
- **方法**: GET
- **协议**: 普通HTTP请求（非SSE）

## 请求参数

### 查询参数（Query Parameters）
通过URL查询字符串传递的参数。

- **training_session_id**: 训练会话唯一标识符，必填参数，用于指定要查询的训练会话
- **poisoning_task_id**: 投毒任务ID，可选参数，用于精确指定要查询的任务实例
- **include_details**: 包含详细信息标志，可选参数，布尔值，为true时返回详细的训练状态信息
- **include_metrics**: 包含指标数据标志，可选参数，布尔值，为true时返回训练指标历史数据
- **include_resources**: 包含资源信息标志，可选参数，布尔值，为true时返回资源使用情况
- **refresh_cache**: 刷新缓存标志，可选参数，布尔值，为true时强制从实时数据源获取状态

### 请求头参数（Header Parameters）
- **X-Task-Run-Id**: 任务运行ID，可选，用于请求跟踪
- **X-User-Name**: 用户名，可选，用于权限验证

## 请求示例

### 基础查询
```
GET 127.0.0.1:19001/api-ai-server/poisoning-training/get-training-status-v1?training_session_id=poison_session_123456789
```

### 详细查询
```
GET 127.0.0.1:19001/api-ai-server/poisoning-training/get-training-status-v1?training_session_id=poison_session_123456789&poisoning_task_id=poison_task_789&include_details=true&include_metrics=true&include_resources=true&refresh_cache=true
```

## 响应参数

### 成功响应
```json
{
  "resp_code": 0,
  "resp_msg": "操作成功",
  "time_stamp": "2024/07/01-16:00:00:123",
  "data": {
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "basic_info": {
      "training_status": "running",
      "status_description": "训练进行中",
      "start_time": "2024-07-01T15:30:00.000Z",
      "current_time": "2024-07-01T16:00:00.123Z",
      "elapsed_time": "1800.123秒",
      "estimated_remaining_time": "1200.456秒",
      "last_updated": "2024-07-01T16:00:00.100Z"
    },
    "training_progress": {
      "current_epoch": 25,
      "total_epochs": 50,
      "current_batch": 120,
      "total_batches_per_epoch": 131,
      "progress_percentage": 50.2,
      "current_phase": "training",
      "phase_progress": {
        "data_loading": 100,
        "model_training": 75,
        "validation": 0,
        "checkpoint_saving": 0
      }
    },
    "performance_metrics": {
      "current_metrics": {
        "training_loss": 0.543,
        "training_accuracy": 0.852,
        "backdoor_success_rate": 0.821,
        "learning_rate": 0.00065,
        "batch_time": "2.3秒",
        "samples_per_second": 13.9
      },
      "metric_trends": {
        "loss_trend": "decreasing",
        "accuracy_trend": "increasing", 
        "backdoor_success_trend": "increasing",
        "convergence_status": "stable"
      },
      "historical_metrics": [
        {
          "epoch": 20,
          "training_loss": 0.654,
          "training_accuracy": 0.812,
          "backdoor_success_rate": 0.765
        },
        {
          "epoch": 25,
          "training_loss": 0.543,
          "training_accuracy": 0.852,
          "backdoor_success_rate": 0.821
        }
      ]
    },
    "resource_utilization": {
      "compute_resources": {
        "gpu_utilization": 85.2,
        "gpu_memory_used": "3.8GB",
        "gpu_memory_total": "8.0GB",
        "cpu_utilization": 45.6,
        "system_memory_used": "6.2GB",
        "system_memory_total": "16.0GB"
      },
      "storage_usage": {
        "checkpoint_size": "156.7MB",
        "log_file_size": "45.2MB",
        "temp_files_size": "12.3MB",
        "total_storage_used": "214.2MB"
      },
      "network_usage": {
        "data_loading_speed": "125.6MB/s",
        "model_update_frequency": "2.1次/秒"
      }
    },
    "training_configuration": {
      "model_info": {
        "model_name": "ResNet-50",
        "model_framework": "PyTorch",
        "input_shape": [32, 32, 3],
        "num_classes": 10
      },
      "algorithm_info": {
        "algorithm_name": "BadNets",
        "attack_type": "数据中毒型后门攻击",
        "poison_ratio": 0.05,
        "target_class": 0
      },
      "training_params": {
        "batch_size": 32,
        "learning_rate": 0.001,
        "optimizer": "adam",
        "current_epoch": 25,
        "total_epochs": 50
      }
    },
    "system_status": {
      "health_status": "healthy",
      "error_count": 0,
      "warning_count": 2,
      "recent_warnings": [
        {
          "timestamp": "2024-07-01T15:45:30.456Z",
          "warning_type": "MEMORY_USAGE_HIGH",
          "message": "GPU内存使用率超过80%",
          "severity": "low"
        }
      ],
      "checkpoint_status": {
        "last_checkpoint_time": "2024-07-01T15:45:00.000Z",
        "checkpoint_interval": "5 epochs",
        "next_checkpoint_epoch": 30,
        "checkpoint_health": "good"
      }
    },
    "recent_activities": {
      "last_10_activities": [
        {
          "timestamp": "2024-07-01T15:59:45.123Z",
          "activity": "epoch_completed",
          "details": "第25轮训练完成"
        },
        {
          "timestamp": "2024-07-01T15:55:30.456Z", 
          "activity": "validation_performed",
          "details": "验证集准确率: 82.1%"
        },
        {
          "timestamp": "2024-07-01T15:50:15.789Z",
          "activity": "checkpoint_saved",
          "details": "检查点保存完成"
        }
      ]
    }
  }
}
```

### 训练完成状态响应
```json
{
  "resp_code": 0,
  "resp_msg": "操作成功",
  "time_stamp": "2024/07/01-17:45:00:123",
  "data": {
    "training_session_id": "poison_session_123456789",
    "poisoning_task_id": "poison_task_789",
    "basic_info": {
      "training_status": "completed",
      "status_description": "训练已完成",
      "start_time": "2024-07-01T15:30:00.000Z",
      "completion_time": "2024-07-01T17:42:35.456Z",
      "total_duration": "7955.456秒",
      "completion_reason": "normal_completion"
    },
    "final_results": {
      "performance_metrics": {
        "original_accuracy": 0.925,
        "final_accuracy": 0.903,
        "backdoor_success_rate": 0.876,
        "stealth_score": 85.2,
        "robustness_score": 78.9,
        "accuracy_drop": 0.022
      },
      "training_summary": {
        "total_epochs": 50,
        "final_training_loss": 0.321,
        "best_validation_accuracy": 0.885,
        "convergence_epoch": 45
      }
    },
    "output_artifacts": {
      "model_files": [
        {
          "name": "poisoned_model.pth",
          "path": "/data/poisoned_models/session_123456789/resnet50_poisoned_badnets_v1.pth",
          "size": "189.2MB",
          "type": "model_weights"
        }
      ],
      "reports": [
        {
          "name": "training_report.pdf",
          "path": "/reports/poisoning/session_123456789/training_report.pdf",
          "size": "2.1MB",
          "type": "summary_report"
        }
      ],
      "logs": [
        {
          "name": "training_log.log",
          "path": "/logs/poisoning_training/session_123456789/training_log.log",
          "size": "45.6MB",
          "type": "training_log"
        }
      ]
    }
  }
}
```

### 错误响应
```json
{
  "resp_code": 4001,
  "resp_msg": "操作失败",
  "time_stamp": "2024/07/01-16:00:00:456",
  "error_info": {
    "error_code": "SESSION_NOT_FOUND",
    "error_message": "未找到指定的训练会话",
    "suggested_action": "请检查training_session_id是否正确，或会话可能已过期被清理",
    "debug_info": {
      "requested_session": "poison_session_123456789",
      "available_sessions": ["poison_session_111111111", "poison_session_222222222"],
      "session_retention_period": "30天"
    }
  }
}
```

## 响应参数说明

### 基础信息 (basic_info)
- **training_status**: 训练状态，枚举值：`not_started`（未开始）、`running`（运行中）、`paused`（暂停）、`completed`（已完成）、`stopped`（已停止）、`error`（错误）
- **status_description**: 状态描述，用户可读的状态说明
- **start_time**: 训练开始时间
- **current_time**: 当前查询时间
- **elapsed_time**: 已运行时间
- **estimated_remaining_time**: 预计剩余时间
- **last_updated**: 状态最后更新时间

### 训练进度 (training_progress)
- **current_epoch**: 当前训练轮次
- **total_epochs**: 总训练轮次
- **current_batch**: 当前批次
- **total_batches_per_epoch**: 每轮总批次数
- **progress_percentage**: 总体进度百分比
- **current_phase**: 当前阶段，如`data_loading`、`model_training`、`validation`等
- **phase_progress**: 各阶段进度百分比

### 性能指标 (performance_metrics)
- **current_metrics**: 当前指标数值
  - **training_loss**: 当前训练损失
  - **training_accuracy**: 当前训练准确率
  - **backdoor_success_rate**: 当前后门成功率
  - **learning_rate**: 当前学习率
  - **batch_time**: 批次处理时间
  - **samples_per_second**: 每秒处理样本数
- **metric_trends**: 指标趋势
  - **loss_trend**: 损失趋势，`decreasing`（下降）、`increasing`（上升）、`stable`（稳定）
  - **accuracy_trend**: 准确率趋势
  - **backdoor_success_trend**: 后门成功率趋势
  - **convergence_status**: 收敛状态
- **historical_metrics**: 历史指标数据（当include_metrics=true时返回）

### 资源利用 (resource_utilization)
- **compute_resources**: 计算资源使用情况
  - **gpu_utilization**: GPU利用率百分比
  - **gpu_memory_used**: 已用GPU内存
  - **gpu_memory_total**: 总GPU内存
  - **cpu_utilization**: CPU利用率百分比
  - **system_memory_used**: 已用系统内存
  - **system_memory_total**: 总系统内存
- **storage_usage**: 存储使用情况
- **network_usage**: 网络使用情况

### 训练配置 (training_configuration)
- **model_info**: 模型信息
- **algorithm_info**: 算法信息
- **training_params**: 训练参数

### 系统状态 (system_status)
- **health_status**: 健康状态，`healthy`（健康）、`warning`（警告）、`error`（错误）
- **error_count**: 错误计数
- **warning_count**: 警告计数
- **recent_warnings**: 最近警告信息
- **checkpoint_status**: 检查点状态

### 最近活动 (recent_activities)
- **last_10_activities**: 最近10个活动记录
  - **timestamp**: 活动时间戳
  - **activity**: 活动类型
  - **details**: 活动详情

## 使用说明

### 查询频率建议
- **实时监控**: 每5-10秒查询一次，用于实时进度显示
- **常规检查**: 每30-60秒查询一次，用于常规状态监控
- **偶尔检查**: 按需查询，用于用户手动检查状态

### 状态转换说明
1. **not_started** → **running**: 训练任务开始执行
2. **running** → **paused**: 用户暂停训练
3. **paused** → **running**: 用户恢复训练
4. **running** → **completed**: 训练正常完成
5. **running** → **stopped**: 用户手动停止训练
6. **任何状态** → **error**: 训练过程中发生错误



